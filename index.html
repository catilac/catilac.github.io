<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <title>hi</title>

    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>

  <body>
    <div class='box'>
      <h1>Chirag Dav√©</h1>

      <section class='about-me'>
        <h3>About Me</h3>
        <p>Fullstack web and iOS developer with 11 years of experience üë¥üèΩ</p>
        <p>Getting real into Graphics Programming using Metal ü§òüèΩ</p>
        <p>I'm learning how to water color!üé®</p>
      </section>
      
      <section class='projects'>
        <h3>Projects</h3>
        <ul>
          <li>
            <a href='https://github.com/catilac/psychout'>PsychOut</a>
          </li>
        </ul>
      </section>

      <section class='links'>
        <h3>Links</h3>
        <ul>
          <li>
            <a href='https://github.com/catilac'>Github</a>
          </li>
          <li>
            <a href='https://linkedin.com/in/chiraggdave'>LinkedIn</a>
          </li>
          <li>
            <a href='https://twitter.com/dogforcedog'>Twitter</a>
          </li>
          <li>
            <a href='https://www.instagram.com/dogforcedog/'>Instagram</a>
          </li>
        </ul>
      </section>

    </div>

    <div id='container'></div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/108/three.min.js'></script>
    <script id="vertexShader" type="x-shader/x-vertex">
        void main() {
            gl_Position = vec4( position, 1.0 );
        }
    </script>
    <script id="fragmentShader" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision mediump float;
        #endif

        uniform vec2 u_resolution;
        uniform vec2 u_mouse;
        uniform float u_time;

        float EPSILON = 0.001;

        // geometry
        float unionSDF(float d0, float d1) {
          return min(d0, d1);
        }

        float intersectSDF(float d0, float d1) {
          return max(d0, d1);
        }

        float differenceSDF(float d0, float d1) {
          return max(d0, -d1);
        }

        float sphereSDF(vec3 p, vec3 center, float r) {
          return length(p - center) - r;
        }

        float planeSDF(vec3 p, float y) {
          return p.y - y;
        }

        float sceneSDF(vec3 pos) {
          float ds0 = sphereSDF(pos, vec3(.5, abs(cos(u_time/2.4)/2.), 0.), 0.3);
          float ds1 = sphereSDF(pos, vec3(sin(u_time/2.)/3. + 0.25, .34, 0.), 0.2);
          float dp = planeSDF(pos, -1.);

          float ds0ds1 = unionSDF(ds0, ds1);

          return unionSDF(ds0ds1, dp);
        }

        vec3 estimateNormal(vec3 p) {
          return normalize(vec3(
          // dx
            sceneSDF(vec3(p.x + EPSILON, p.y, p.z) -
            sceneSDF(vec3(p.x - EPSILON, p.y, p.z))),

          // dy
            sceneSDF(vec3(p.x, p.y + EPSILON, p.z) -
            sceneSDF(vec3(p.x, p.y - EPSILON, p.z))),

          // dz
            sceneSDF(vec3(p.x, p.y, p.z + EPSILON) -
            sceneSDF(vec3(p.x, p.y, p.z - EPSILON)))
          ));
        }

        float lighting(vec3 ro, vec3 rd, vec3 n) {
          vec3 lightRay = normalize(vec3(2., 2., 0) - ro);
          float diffuse = max(0.0, dot(n, lightRay));
          // I - 2.0 * dot(N, I) * N.
          vec3 reflectedRay = rd - 2. * dot(n, rd) * n;
          float specular = max(0.0, dot(reflectedRay, lightRay));
          specular = pow(specular, 200.0);
          return diffuse + specular;
        }


        vec3 trace(vec3 rayOrigin, vec3 dir) {
          float totalDist = 0.;
          vec3 color = vec3(0.);

          for (int i = 0; i < 100; i++) {
            float dist = sceneSDF(rayOrigin);

            rayOrigin += dist * dir;
            totalDist += dist;

            if (dist < EPSILON) {
              color = vec3(totalDist);
              break;
            }
          }

          vec3 n = estimateNormal(rayOrigin);
          float l = lighting(rayOrigin, dir, n);
          return color * l;
        }
        
        void main() {
            vec2 st = -1. + 2. * gl_FragCoord.xy/u_resolution;

            vec3 cameraOrigin = vec3(0., 0., -1.);
            vec3 rayOrigin = vec3(st.x, st.y, 0);
            vec3 dir = normalize(rayOrigin - cameraOrigin);
            
            gl_FragColor = vec4(trace(cameraOrigin, dir), 1.0);
        }
    </script>
    <script src='app.js'></script>
  </body>

</html>
